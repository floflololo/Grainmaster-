<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#071016" />
  <title>GrainMaster</title>

  <link rel="manifest" href="manifest.webmanifest?v=8" />
  <link rel="icon" href="icons/icon-192.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css?v=8" />
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">GM</div>
    <div>
      <div class="title">GrainMaster</div>
      <div class="subtitle">Drescheinstellungen & Verlustoptimierung</div>
    </div>
  </div>

  <div class="topbar-actions">
    <button class="btn ghost" id="btnInstall" hidden>Installieren</button>
    <button class="btn ghost" id="btnExport">Export</button>
    <button class="btn ghost" id="btnImport">Import</button>
    <button class="btn ghost danger" id="btnReset">Reset</button>
  </div>
</header>

<main class="layout">
  <section class="panel" id="panelMachine">
    <div class="panel-head">
      <h2>Maschine</h2>
      <div class="pill" id="statusPill">Bereit</div>
    </div>

    <div class="grid">
      <label class="field">
        <span>Marke</span>
        <select id="brand"></select>
      </label>

      <label class="field">
        <span>Modell</span>
        <select id="model"></select>
      </label>

      <label class="field span-2">
        <span>Profil</span>
        <input id="machineSummary" type="text" readonly />
      </label>
    </div>

    <div class="row">
      <button class="btn primary" id="btnStartwerte">Startwerte berechnen</button>
      <button class="btn" id="btnResetManual">Manuell zurücksetzen</button>

      <label class="pill subtle" style="display:flex;gap:10px;align-items:center;">
        <span style="color:#9fb6c9;font-size:12px;">Auto-Startwerte</span>
        <input id="autoRecalc" type="checkbox" style="transform:scale(1.15);">
      </label>

      <button class="btn warn" id="btnVorschlaege">Vorschläge</button>
      <button class="btn" id="btnClearProblems">Probleme löschen</button>
      <button class="btn ghost" id="btnScrollAdvisor">↓ Zum Advisor</button>
    </div>
  </section>

  <section class="panel" id="panelField">
    <div class="panel-head">
      <h2>Feldprofil</h2>
      <div class="pill subtle" id="stabilityPill">Stabilität: —</div>
    </div>

    <div class="grid">
      <label class="field">
        <span>Kultur</span>
        <select id="crop">
          <option value="weizen">Weizen</option>
          <option value="gerste">Gerste</option>
          <option value="raps">Raps</option>
          <option value="mais">Mais</option>
          <option value="soja">Soja</option>
        </select>
      </label>

      <label class="field">
        <span>Modus</span>
        <select id="mode">
          <option value="balanced">Ausgewogen</option>
          <option value="throughput">Max. Durchsatz</option>
          <option value="clean">Sauberes Korn</option>
          <option value="loss">Minimale Verluste</option>
        </select>
      </label>

      <label class="field">
        <span>Ertrag (t/ha)</span>
        <input id="yieldT" type="number" min="0" step="0.1" />
      </label>

      <label class="field">
        <span>Kornfeuchte (%)</span>
        <input id="moisture" type="number" min="0" step="0.1" />
      </label>

      <label class="field">
        <span>Strohzustand</span>
        <select id="straw">
          <option value="normal">normal</option>
          <option value="trocken">trocken</option>
          <option value="zäh">zäh/grün</option>
          <option value="lager">lagernd</option>
        </select>
      </label>

      <label class="field">
        <span>Grünanteil</span>
        <select id="green">
          <option value="low">gering</option>
          <option value="med">mittel</option>
          <option value="high">hoch</option>
        </select>
      </label>

      <label class="field">
        <span>Schneidwerkbreite (m)</span>
        <input id="headerWidth" type="number" min="3" step="0.1" />
      </label>

      <label class="field">
        <span>Notizen</span>
        <input id="notes" type="text" placeholder="z.B. Wind, Lager, Nordstück" />
      </label>
    </div>
  </section>

  <section class="panel" id="panelProblems">
    <div class="panel-head">
      <h2>Probleme auswählen (mehrfach)</h2>
      <div class="pill subtle" id="problemsPill">0 gewählt</div>
    </div>
    <p class="hint">Antippen → Lösungen erscheinen sofort im Advisor.</p>
    <div class="problem-groups" id="problemGroups"></div>
  </section>

  <section class="panel" id="panelObs">
    <div class="panel-head">
      <h2>Verlust-/Prozesswerte (0–10)</h2>
      <div class="pill subtle">optional</div>
    </div>

    <div class="grid grid-2">
      <label class="field"><span>Heckverluste</span><input id="rearLoss" type="range" min="0" max="10" /><span class="mini" id="rearLossVal"></span></label>
      <label class="field"><span>Siebverluste</span><input id="sieveLoss" type="range" min="0" max="10" /><span class="mini" id="sieveLossVal"></span></label>
      <label class="field"><span>Rücklauf</span><input id="tailings" type="range" min="0" max="10" /><span class="mini" id="tailingsVal"></span></label>
      <label class="field"><span>Rotorlast</span><input id="rotorLoad" type="range" min="0" max="10" /><span class="mini" id="rotorLoadVal"></span></label>
      <label class="field"><span>Bruchkorn</span><input id="cracks" type="range" min="0" max="10" /><span class="mini" id="cracksVal"></span></label>
      <label class="field"><span>Unsauber</span><input id="dirty" type="range" min="0" max="10" /><span class="mini" id="dirtyVal"></span></label>
    </div>
  </section>

  <section class="panel" id="panelAdvisor">
    <div class="panel-head">
      <h2>Advisor</h2>
      <div class="pill subtle" id="stepPill">0 Schritte</div>
    </div>

    <h2>Drescheinstellungen (aktuell)</h2>
    <div class="cards" id="cards"></div>

    <div class="hr"></div>

    <h2>Lösungen / Schritte</h2>
    <div id="steps" class="steps"></div>

    <div class="hr"></div>

    <h2>Manuell einstellen</h2>
    <div id="tuning" class="tuning"></div>

    <div class="hr"></div>

    <h2>Checkliste</h2>
    <div id="checklist" class="checklist"></div>

    <div class="hr"></div>

    <h2>Feedback</h2>
    <div class="row">
      <button class="btn" id="btnBetter">Besser</button>
      <button class="btn" id="btnSame">Gleich</button>
      <button class="btn" id="btnWorse">Schlechter</button>
    </div>

    <div class="row">
      <button class="btn ghost" id="btnScrollTop">↑ Nach oben</button>
    </div>
  </section>
</main>

<dialog id="dlgImport" class="dlg">
  <form method="dialog" class="dlg-inner">
    <div class="dlg-head">
      <h3>Import</h3>
      <button class="btn ghost" value="cancel" aria-label="Schließen">✕</button>
    </div>
    <textarea id="importText" class="textarea" rows="10" spellcheck="false"></textarea>
    <div class="dlg-actions">
      <button class="btn" value="cancel">Abbrechen</button>
      <button class="btn primary" id="btnImportApply" value="default">Importieren</button>
    </div>
  </form>
</dialog>

<dialog id="dlgExport" class="dlg">
  <form method="dialog" class="dlg-inner">
    <div class="dlg-head">
      <h3>Export</h3>
      <button class="btn ghost" value="cancel" aria-label="Schließen">✕</button>
    </div>
    <textarea id="exportText" class="textarea" rows="10" spellcheck="false" readonly></textarea>
    <div class="dlg-actions">
      <button class="btn" value="cancel">Schließen</button>
      <button class="btn" id="btnCopy">Kopieren</button>
      <button class="btn primary" id="btnDownload">Download</button>
    </div>
  </form>
</dialog>

<script src="machine-data.js?v=8"></script>
<script src="advisor-engine.js?v=8"></script>
<script src="app.js?v=8"></script>
</body>
</html>
