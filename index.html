<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#071016" />
  <title>Mähdrescher Advisor</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">AD</div>
    <div>
      <div class="title">Mähdrescher Advisor</div>
      <div class="subtitle">Marke/Modell → Probleme → Schritte → manuell feinjustieren</div>
    </div>
  </div>

  <div class="topbar-actions">
    <button class="btn ghost" id="btnInstall" hidden>Installieren</button>
    <button class="btn ghost" id="btnExport">Export</button>
    <button class="btn ghost" id="btnImport">Import</button>
    <button class="btn ghost danger" id="btnReset">Reset</button>
  </div>
</header>

<main class="layout">
  <!-- VIEW 1: Auswahl -->
  <section class="panel" id="view-select">
    <div class="panel-head">
      <h2>Maschine auswählen</h2>
      <div class="pill" id="statusPill">Bereit</div>
    </div>

    <p class="hint">
      Wähle zuerst Marke und Modell. Danach bekommst du die optimierte Advisor-Seite für den Maschinentyp
      (Rotor / Schüttler / Hybrid) mit passenden Grenzwerten und Vorschlägen.
    </p>

    <div class="grid">
      <label class="field">
        <span>Marke</span>
        <select id="brand"></select>
      </label>

      <label class="field">
        <span>Modell</span>
        <select id="model"></select>
      </label>

      <label class="field span-2">
        <span>Maschinenprofil (automatisch)</span>
        <input id="machineSummary" type="text" readonly />
      </label>
    </div>

    <div class="row">
      <button class="btn primary" id="btnGoAdvisor">Weiter</button>
      <button class="btn ghost" id="btnEditModelJson">Modelldaten anzeigen</button>
    </div>

    <div class="hr"></div>

    <h2>Hinweis zur Modellabdeckung</h2>
    <div class="footer-note">
      Die App kann nur so „exakt“ sein, wie die hinterlegten Maschinenprofile. Im Build sind starke Profile
      für die wichtigsten Familien enthalten (CR / Axial-Flow / Lexion / S / X9). Du kannst jederzeit weitere
      Modelle hinzufügen: rein in <strong>machine-data.js</strong> – ohne Logik anzufassen.
    </div>

    <dialog id="dlgModels" class="dlg">
      <form method="dialog" class="dlg-inner">
        <div class="dlg-head">
          <h3>Modelldaten (machine-data.js)</h3>
          <button class="btn ghost" value="cancel" aria-label="Schließen">✕</button>
        </div>
        <p class="hint">Nur zur Ansicht. Erweiterung machst du in der Datei machine-data.js.</p>
        <textarea id="modelsDump" class="textarea" rows="14" spellcheck="false" readonly></textarea>
        <div class="dlg-actions">
          <button class="btn primary" value="cancel">Schließen</button>
        </div>
      </form>
    </dialog>
  </section>

  <!-- VIEW 2: Advisor -->
  <section class="panel hidden" id="view-advisor">
    <div class="panel-head">
      <h2 id="machineTitle">Advisor</h2>
      <div class="pill" id="confidencePill">Stabilität: —</div>
    </div>

    <div class="row" style="margin-top:0;">
      <button class="btn ghost" id="btnBack">← Maschine wechseln</button>
      <button class="btn primary" id="btnCompute">Startwerte</button>
      <button class="btn warn" id="btnSuggest">Vorschläge</button>
      <button class="btn" id="btnClearProblems">Probleme löschen</button>
    </div>

    <div class="hr"></div>

    <h2>Feldprofil</h2>
    <div class="grid">
      <label class="field">
        <span>Kultur</span>
        <select id="crop">
          <option value="weizen">Weizen</option>
          <option value="gerste">Gerste</option>
          <option value="raps">Raps</option>
          <option value="mais">Mais</option>
          <option value="soja">Soja</option>
        </select>
      </label>

      <label class="field">
        <span>Modus</span>
        <select id="mode">
          <option value="balanced">Ausgewogen</option>
          <option value="throughput">Max. Durchsatz</option>
          <option value="clean">Sauberes Korn</option>
          <option value="loss">Minimale Verluste</option>
        </select>
      </label>

      <label class="field">
        <span>Ertrag (t/ha)</span>
        <input id="yieldT" type="number" min="0" step="0.1" value="8" />
      </label>

      <label class="field">
        <span>Kornfeuchte (%)</span>
        <input id="moisture" type="number" min="0" step="0.1" value="14" />
      </label>

      <label class="field">
        <span>Strohzustand</span>
        <select id="straw">
          <option value="normal">normal</option>
          <option value="trocken">trocken</option>
          <option value="zäh">zäh/grün</option>
          <option value="lager">lagernd</option>
        </select>
      </label>

      <label class="field">
        <span>Grünanteil</span>
        <select id="green">
          <option value="low">gering</option>
          <option value="med">mittel</option>
          <option value="high">hoch</option>
        </select>
      </label>

      <label class="field">
        <span>Schneidwerkbreite (m)</span>
        <input id="headerWidth" type="number" min="3" step="0.1" value="12.2" />
      </label>

      <label class="field">
        <span>Notizen</span>
        <input id="notes" type="text" placeholder="z.B. Nordstück, Wind, Lager" />
      </label>
    </div>

    <div class="hr"></div>

    <h2>Probleme auswählen (mehrfach)</h2>
    <p class="hint">Wie Advisor: wähle Symptome, dann bekommst du priorisierte Schritte.</p>
    <div class="problem-groups" id="problemGroups"></div>

    <div class="hr"></div>

    <h2>Drescheinstellungen</h2>
    <div class="cards" id="cards"></div>

    <div class="hr"></div>

    <div class="panel-head">
      <h2>Empfohlene Schritte</h2>
      <div class="pill subtle" id="stepPill">0 Schritte</div>
    </div>
    <div id="steps" class="steps"></div>

    <div class="hr"></div>

    <h2>Manuell einstellen</h2>
    <p class="hint">Slider + Zahleneingabe. Alles wird gespeichert. Grenzwerte passen zum Maschinenprofil.</p>
    <div id="tuning" class="tuning"></div>

    <div class="hr"></div>

    <h2>Feedback (lernt pro Maschine & Kultur)</h2>
    <p class="hint">Nach dem Prüfen: Wie ist es geworden?</p>
    <div class="row">
      <button class="btn" id="btnBetter">Besser</button>
      <button class="btn" id="btnSame">Gleich</button>
      <button class="btn" id="btnWorse">Schlechter</button>
    </div>

    <div class="hr"></div>

    <h2>Checkliste</h2>
    <div id="checklist" class="checklist"></div>
  </section>
</main>

<!-- Import/Export -->
<dialog id="dlgImport" class="dlg">
  <form method="dialog" class="dlg-inner">
    <div class="dlg-head">
      <h3>Import</h3>
      <button class="btn ghost" value="cancel" aria-label="Schließen">✕</button>
    </div>
    <p class="hint">Export-JSON einfügen.</p>
    <textarea id="importText" class="textarea" rows="10" spellcheck="false"></textarea>
    <div class="dlg-actions">
      <button class="btn" value="cancel">Abbrechen</button>
      <button class="btn primary" id="btnImportApply" value="default">Importieren</button>
    </div>
  </form>
</dialog>

<dialog id="dlgExport" class="dlg">
  <form method="dialog" class="dlg-inner">
    <div class="dlg-head">
      <h3>Export</h3>
      <button class="btn ghost" value="cancel" aria-label="Schließen">✕</button>
    </div>
    <p class="hint">Kopieren oder Download.</p>
    <textarea id="exportText" class="textarea" rows="10" spellcheck="false" readonly></textarea>
    <div class="dlg-actions">
      <button class="btn" value="cancel">Schließen</button>
      <button class="btn" id="btnCopy">Kopieren</button>
      <button class="btn primary" id="btnDownload">Download</button>
    </div>
  </form>
</dialog>

<script src="machine-data.js"></script>
<script src="advisor-engine.js"></script>
<script src="app.js"></script>
</body>
</html>
